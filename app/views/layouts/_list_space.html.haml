/========================
/ "List A Space" Form
/========================

.panel.panel-default
  .panel-body.tab-display
    .form-container.row
      = form_for @listing, :html => {:id => "newlisting_form", :multipart => true} do |f|
        .col-md-12

          / Tab List
          %ul.list-unstyled.list-inline.col-md-12.text-center
            %li
              = link_to "#name", :class => "inner-tab-link active" do
                Name & Desc.
            %li
              = link_to "#address", :class => "inner-tab-link" do
                Location
            %li
              = link_to "#dates", :class => "inner-tab-link" do
                Dates
            %li
              = link_to "#rates", :class => "inner-tab-link" do
                Rates
            %li
              = link_to "#upload-pictures", :class => "inner-tab-link" do
                Pics



        / Tabs - Each Step is its own tab.
        #steps.col-md-12


          / Step 1: Name and Description
          #name.inner-tab.active.col-md-12
            = f.text_field :name, :class => "form-control", :placeholder => "Name"
            = f.text_field :description, :id => "description", :class => "form-control", :placeholder => "Description", 'data-provider' =>  'summernote'




          / Step 2: List the Address
          #address.inner-tab.col-md-12
            %h4
              Address
            = f.fields_for :location do |l|
              = l.text_field :street_address, :class => "form-control", :placeholder => "Street Address"
              .row
                .col-md-8
                  = l.text_field :city, :class => "form-control", :placeholder => "City"
                .col-md-2
                  = l.select :state, options_for_select(us_states), {:prompt => "State"}, class: "form-control"
                .col-md-2
                  = l.text_field :zip, :class => "form-control", :placeholder => "Zip"
            %br
            %br




          / Step 3: Specify Dates
          #dates.inner-tab.col-md-12




          / Step 4: Add Rates
          #rates.inner-tab.col-md-12
            %h4
              Rates
              %span.add-subtract-rate-forms
                %i#add-rate-form.fa.fa-plus-square-o.fa-lg
                %i#subtract-rate-form.fa.fa-minus-square-o.fa-lg

            / Show at least one "Rates" form
            = render :partial => 'listings/rates_form', :locals => { :f => f }

            / Div to hold additional rates if user clicks on the +/- 
            #additional-rate-forms

            / Adds and Removes extra rate forms 
            :javascript
              $(document).ready(function() {
                $("#add-rate-form").on("click", function(e) {

                  // Prevent the form from being accidentally submitted
                  e.preventDefault();

                  // Append the "rates_form" partial when the #add-rate-form btn (+) is clicked
                  $("#additional-rate-forms").append("#{ escape_javascript( render :partial => 'listings/rates_form', :locals => {:f => f} ) }");

                  // Hide the (+) sign if the number of rates_forms outgrows the number of options (hourly, weekly, etc)
                  if ($("#additional-rate-forms").children().length == parseInt("#{times.count}") - 1) {
                    $("#add-rate-form").hide();
                  } else {
                    $("#add-rate-form").show();
                  }
                });
              });




          / Step 5: Upload Pictures
          #upload-pictures.inner-tab.col-md-12
            %h4
              Upload Pictures
            = f.fields_for :pictures do |p|
              = p.file_field :image, :multiple => true, :name => "image[]"
            .row.next-prev-btns
              .col-md-6.text-left
                = render 'layouts/prev_btn'
              .col-md-6
                = f.submit "Post Listing", :class => "btn btn-primary form-control"


  .panel-footer
    .row.next-prev-btns
      .col-md-6.text-left
        = render 'layouts/prev_btn'
      .col-md-6.text-right
        = render 'layouts/next_btn'




:javascript
  $(document).ready(function() {

    var formSections = $(".inner-tab-link");

    // Enable Summernote
    $('[data-provider="summernote"]').each(function(){
      $(this).summernote({
        height: 300
       });
    });

    // Retrieve value from Summernote text editor on "List A Space" form submission
    $('#newlisting_form').submit(function(){
      $("#description").val($('[data-provider="summernote"]').code());
    });


    // Next and Previous Buttons for "List A Space" form
    $(".next-btn").on("click", function(e) {
      e.preventDefault();
      formSections.filter('.active').parent().next('li').find('a').click();
    });

    $(".prev-btn").on("click", function(e) {
      e.preventDefault();
      formSections.filter('.active').parent().prev('li').find('a').click();
    });


    // Tabs 
    $(".inner-tab-link").on("click", function(e) {
      e.preventDefault();

      var id = $(this).attr("href");

      $(".inner-tab-link").removeClass("active");
      $(this).addClass("active");

      $(".inner-tab").removeClass("active");
      $(id).addClass("active");
    });
  });